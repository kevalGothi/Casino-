<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>User Profile</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="//cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">
    <link rel="stylesheet" href="/dist/css/adminlte.min.css">
    <link rel="stylesheet" href="/css/admin.css">
</head>

<body class="hold-transition sidebar-mini">
    <div class="wrapper">
        <%- include('nav') %>
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h1>User Information</h1>
                        </div>
                    </div>
                </div>
                <!-- /.container-fluid -->
            </section>

            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-3">

                            <!-- Profile Image -->
                            <div class="card card-primary card-outline">
                                <div class="card-body box-profile">
                                    <div class="text-center">
                                        <img class="profile-user-img img-fluid img-circle" src="/images/avatar.svg" alt="User profile picture">
                                    </div>

                                    <h3 class="profile-username text-center">Member...</h3>

                                    <p class="text-muted text-center" id="id_user">ID: 0</p>
                                    
                                     <button class="btn btn-danger btn-block" id="updateWithdrawalSettingBox">
                                            <b style="text-transform: uppercase;" id="updateWithdrawalSetting">Only
                                                Winning withdrawal</b>
                                        </button>

                                    <ul class="list-group list-group-unbordered mb-3">
                                        <li class="list-group-item">
                                            <b>Balance</b> <a class="float-right" id="money">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>Total Deposite</b> <a class="float-right" id="total_money">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>Total Withdraw</b> <a class="float-right" id="total_withdraw">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>Total commission</b> <a class="float-right" id="roses_all">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>Today commission</b> <a class="float-right" id="roses_today">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>L1</b> <a class="float-right" id="f1">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>L2</b> <a class="float-right" id="f2">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>L3</b> <a class="float-right" id="f3">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>L4</b> <a class="float-right" id="f4">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>L5</b> <a class="float-right" id="f5">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>L6</b> <a class="float-right" id="f6">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>L7</b> <a class="float-right" id="f7">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>L8</b> <a class="float-right" id="f8">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>L9</b> <a class="float-right" id="f9">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>L10</b> <a class="float-right" id="f10">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>General invitation</b> <a class="float-right" id="total_mem">0</a>
                                        </li>
                                        <li class="list-group-item">
                                            <b>IP</b> <a class="float-right" id="ip">157.296.591.22</a>
                                        </li>
                                        <!-- <li class="list-group-item">
                                            <b>Telegram</b> <a class="float-right" id="telegram" href="Loading...">Loading...</a>
                                        </li> -->
                                        <li class="list-group-item">
                                            <b>Inviter</b> <a class="float-right" id="invite">Loading...</a>
                                        </li>
                                        <!-- <li class="list-group-item">
                                            <b>DAILY</b> <a class="float-right" id="daily">Loading...</a>
                                        </li> -->
                                    </ul>

                                        <button class="btn btn-primary btn-block" id="updateSubAdmin">
                                            <b style="text-transform: uppercase;" id="isSubAdmin">Subadmin</b>
                                        </button>
                                    <a  class="btn btn-primary btn-block">
                                        <b style="text-transform: uppercase;" id="level">USER</b>
                                    </a>
                                    <button class="btn btn-primary btn-block" id="login">
                                        <b style="text-transform: uppercase;" >Log in</b>
                                    </button>
                                </div>
                                <!-- /.card-body -->
                            </div>
                            <!-- /.card -->

                            <!-- About Me Box -->
                           <div class="card card-primary">
                                    <div class="card-header">
                                        <h3 class="card-title">Bank information</h3>
                                    </div>
                                    <!-- /.card-header -->
                                    <div class="">
                                        <div class="card-body">
                                            <form id="bankForm">
                                                <div class="form-group">
                                                    <label>Bank Name</label>
                                                    <input type="text" name="name_bank" class="form-control" value="0"
                                                        >
                                                </div>

                                                <div class="form-group">
                                                    <label>Name</label>
                                                    <input type="text" name="name_user" class="form-control" value="0"
                                                        >
                                                </div>

                                                <div class="form-group">
                                                    <label>Account Number</label>
                                                    <input type="text" name="stk" class="form-control" value="0"
                                                        >
                                                </div>
                                                <div class="form-group">
                                                    <label>IFSC CODE</label>
                                                    <input type="text" name="email" class="form-control" value="0"
                                                        >
                                                </div>
                                                <div class="form-group">
                                                    <label>Phone number</label>
                                                    <input type="text" name="tinh" class="form-control" value="0"
                                                        >
                                                </div>
                                                <div class="form-group">
                                                    <label>UPI ID</label>
                                                    <input type="text" name="upi" class="form-control" value="0"
                                                        >
                                                </div>

                                                <div class="form-group">
                                                    <label>BEP</label>
                                                    <input type="text" name="bep" class="form-control" value="0"
                                                        >
                                                </div>

                                                <div class="form-group">
                                                    <label>TRC</label>
                                                    <input type="text" name="trc" class="form-control" value="0"
                                                        >
                                                </div>

                                                <div class="form-group">
                                                    <label>Nagad</label>
                                                    <input type="text" name="nagad" class="form-control" value="0">
                                                </div>

                                                <div class="form-group">
                                                    <label>Bkash</label>
                                                    <input type="text" name="bkash" class="form-control" value="0"
                                                        >
                                                </div>

                                                <button type="submit" class="btn btn-primary btn-block">Update</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                </div>
                        <div class="col-md-9" style="overflow: auto;">
                            <!-- Table Recharge -->
                            <%- include('table/listRecharge.ejs') %>
                            <!-- END TABLE -->
                            <!-- Table Withdraw -->
                            <%- include('table/listWithdraw.ejs') %>
                            <!-- END TABLE -->
                            <!-- Table Withdraw -->
                            <%- include('table/listRedenvelope.ejs') %>
                            <!-- END TABLE -->
                            <!-- Table Withdraw -->
                            <%- include('table/listBet.ejs') %>
                            <!-- END TABLE -->
                             <!-- Table Withdraw -->
                            <%- include('table/listRoi.ejs') %>
                            <!-- END TABLE -->
                        </div> 
                    </div>
                </div>
                <input type="hidden" value="" id="userPhone">
                <input type="hidden" value="" id="userPass">

            </section> 
        </div>
    </div>
    <script src="/plugins/jquery/jquery.min.js"></script>
    <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/dist/js/adminlte.min.js"></script>
    <script src="/js/admin/admin.js"></script>
     <script src="//cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <script>
    
    function formateT(params) {
    let result = (params < 10) ? "0" + params : params;
    return result;
    }
    
    function timerJoin(params = '', addHours = 0) {
        let date = '';
        if (params) {
            date = new Date(Number(params));
        } else {
            date = new Date();
        }
    
        date.setHours(date.getHours() + addHours);
    
        let years = formateT(date.getFullYear());
        let months = formateT(date.getMonth() + 1);
        let days = formateT(date.getDate());
    
        let hours = date.getHours() % 12;
        hours = hours === 0 ? 12 : hours;
        let ampm = date.getHours() < 12 ? "AM" : "PM";
    
        let minutes = formateT(date.getMinutes());
        let seconds = formateT(date.getSeconds());
    
        return years + '-' + months + '-' + days + ' ' + hours + ':' + minutes + ':' + seconds + ' ' + ampm;
    }

    </script>
    <script>
        let url = window.location.pathname;
        let phones = url.split('/');
        let phone = phones[phones.length - 1];
        $.ajax({
    type: "POST",
    url: "/api/webapi/admin/member/info",
    data: {
        phone: phone,
    },
    dataType: "json",
    success: function (response) {
        let total_R = (response.total_r[0].total) ? response.total_r[0].total + '.0' : '0.0';
        console.log("thos : " + total_R)
        console.log("this is user details :" + JSON.stringify((response.total_r[0].total))); // Log the entire response object for debugging
        if (response.status === false) {
            console.error("Request failed or returned false status:", response);
            return false;
        }

        $('#total_money').text((response.total_r[0].total) ? response.total_r[0].total + '.0' : '0.0');
        $('#total_withdraw').text((response.total_w[0].total) ? response.total_w[0].total + '.0' : '0.0');
        let user = response.datas[0];
        console.log(user, 'user');

        // Update user profile information
        $('.profile-username').text(user.name_user);
        $('#id_user').text("ID: " + user.id_user);
        $('#money').text(user.money + ".0");
        $('#roses_all').text(user.roses_f + user.roses_f1 + '.0');
        $('#roses_today').text(user.roses_today + '.0');
        $('#ip').text(user.ip_address);
        $("#userPhone").val(user.phone);
        $("#userPass").val(user.plain_password);
        $('#isSubAdmin').text((user.level == 23) ? "Remove Sub Admin" : "Mark sub admin");
        $('#level').text((user.level == 1) ? 'ADMIN' : (user.level == 2) ? "CTV" : (user.level == 23) ? "SUBADMIN" : "USER");

        // Update referral information
        $('#f1').text(response.f1 + " member");
        $('#f2').text(response.f2 + " member");
        $('#f3').text(response.f3 + " member");
        $('#f4').text(response.f4 + " member");
        $('#f5').text(response.f5 + " member");
        $('#f6').text(response.f6 + " member");
        $('#f7').text(response.f7 + " member");
        $('#f8').text(response.f8 + " member");
        $('#f9').text(response.f9 + " member");
        $('#f10').text(response.f10 + " member");
        $('#total_mem').text(response.f1 + response.f2 + response.f3 + response.f4 + response.f5 + response.f6 + response.f7 + response.f8 + response.f9 + response.f10);

        // Update other information if available
        $('#invite').text(response.ng_moi.phone);
        $('#daily').text(response.daily);
        $('#telegram').text(response.telegram?.telegram || "N/A");
        $('#telegram').attr('href', response.telegram?.telegram || "N/A");
       
        // Update total money and total withdraw
        $('#total_money').text((response.total_r[0].total) ? response.total_r[0].total + '.0' : '0.0');
        $('#total_withdraw').text((response.total_w[0].total) ? response.total_w[0].total + '.0' : '0.0');
        
        $('#updateWithdrawalSetting').text(user.avatar_withdrawal ? "Remove All withdrawal" : "Add All Withdrawal");
                if (!user.avatar_withdrawal) {
                    $('#updateWithdrawalSettingBox').css('background-color', 'green');
                }

        // Update bank information if available
                if (response.bank_user && response.bank_user[0]) {
                    const data = response.bank_user[0];
                    $('input[name="name_bank"]').val(data.name_bank);
                    $('input[name="name_user"]').val(data.name_user);
                    $('input[name="stk"]').val(data.stk);
                    $('input[name="email"]').val(data.email);
                    $('input[name="tinh"]').val(data.tinh);
                    $('input[name="upi"]').val(data.upi);
                    $('input[name="bep"]').val(data.bep);
                    $('input[name="trc"]').val(data.trc);
                    $('input[name="nagad"]').val(data.nagad);
                    $('input[name="bkash"]').val(data.bkash);
                }
    },
    error: function (xhr, status, error) {
        console.error("AJAX request failed:", status, error);
    }
});

    </script>

    <!--Withdraw-->
    <script>
        const RenderWithdraw = (datas) => {
            if (datas.length == 0) {
                $('#list-withdraw').html(`
                    <tr class="text-center">
                    <td colspan="7">no data...</td>
                    </tr>
                `);
                return;
            }
            let html = '';
            datas.map((data) => {
                html += 
                `
                <tr class="text-center" style="">
                    <td style="color: #e74c3c;font-weight: 600;min-width: 210px">${data.id_order}</td>
                    <td><b style="color: #3498db">${(data.money)}</b></td>
                    <td style="min-width: 210px;"><b>${data.name_bank}</b></td>
                    <td class="project-state"><span class="badge badge-${(data.status == '1' ? 'success' : 'danger')}">${(data.status == '1' ? 'success' : 'closed')}</span></td>
                    <td style="min-width: 210px;"><b>${timerJoin(data.time)}</b></td>
                </tr>
                `;
            });
            $("#list-withdraw").html(html);
        }

        var pageno = 0;
        var limit = 15;
        var page = 1;
        $.ajax({
        type: "POST",
        url: "/admin/member/listWithdraw/<%=phone%>",
        data: {
            typeid: "1",
            pageno: pageno,
            limit: limit,
            language: "vi",
        },
        dataType: "json",
        success: function (response) {
            $('#text-withdraw').text(page + ' / ' + response.page_total);
            if (response.status === true) return RenderWithdraw(response.datas);
        },
        });

        $('#nextWithdraw').click(function (e) {
        pageno += limit;
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/admin/member/listWithdraw/<%=phone%>",
            data: {
            typeid: "1",
            pageno: pageno,
            limit: limit,
            language: "vi",
            },
            dataType: "json",
            success: function (response) {
            if(response.datas.length == 0) {
                $('#nextRecharge').addClass('block-click');
                return pageno -= limit
            };
            $('#text-withdraw').text(++page + ' / ' + response.page_total);
            if (response.status === true) return RenderWithdraw(response.datas);
            }
        });
        });
        
        $('#previousWithdraw').click(function (e) { 
        e.preventDefault();
        $('#nextWithdraw').removeClass('block-click');
        pageno -= limit;
        if(pageno < 0) return pageno = 0;
        $.ajax({
            type: "POST",
            url: "/admin/member/listWithdraw/<%=phone%>",
            data: {
            typeid: "1",
            pageno: pageno,
            limit: limit,
            language: "vi",
            },
            dataType: "json",
            success: function (response) {
            $('#text-withdraw').text(--page + ' / ' + response.page_total);
            if (response.status === true) return RenderWithdraw(response.datas);
            }
        });
        });
    </script>
    <!--Withdraw-->

    <!--Recharge-->
    <script>
        const RenderRecharge = (datas) => {
            if (datas.length == 0) {
                $('#list-recharge').html(`
                    <tr class="text-center">
                    <td colspan="7">no data...</td>
                    </tr>
                `);
                return;
            }
            let html = '';
            datas.map((data) => {
                html += 
                `
                <tr class="text-center" style="">
                    <td style="color: #e74c3c;font-weight: 600;min-width: 210px">${data.id_order}</td>
                    <td><b style="color: #3498db">${(data.money)}</b></td>
                    <td style="min-width: 210px;"><b>${(data.type == "bank") ? "BANK" : "UPI"}</b></td>
                    <td class="project-state"><span class="badge badge-${(data.status == '1' ? 'success' : 'warning')}">${(data.status == '1' ? 'success' : 'closed')}</span></td>
                    <td style="min-width: 210px;"><b>${timerJoin(data.time)}</b></td>
                </tr>
                `;
            });
            $("#list-recharge").html(html);
        }

        var pageno1 = 0;
        var limit1 = 15;
        var page1 = 1;
        $.ajax({
        type: "POST",
        url: "/admin/member/listRecharge/<%=phone%>",
        data: {
            typeid: "1",
            pageno: pageno1,
            limit: limit1,
            language: "vi",
        },
        dataType: "json",
        success: function (response) {
            $('#text-recharge').text(page1 + ' / ' + response.page_total);
            if (response.status === true) return RenderRecharge(response.datas);
        },
        });

        $('#nextRecharge').click(function (e) {
        pageno1 += limit1;
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/admin/member/listRecharge/<%=phone%>",
            data: {
            typeid: "1",
            pageno: pageno1,
            limit: limit1,
            language: "vi",
            },
            dataType: "json",
            success: function (response) {
            if(response.datas.length == 0) {
                $('#nextRecharge').addClass('block-click');
                return pageno1 -= limit1
            };
            $('#text-recharge').text(++page1 + ' / ' + response.page_total);
            if (response.status === true) return RenderRecharge(response.datas);
            }
        });
        });
        
        $('#previousRecharge').click(function (e) { 
        e.preventDefault();
        $('#nextRecharge').removeClass('block-click');
        pageno1 -= limit1;
        if(pageno1 < 0) return pageno1 = 0;
        $.ajax({
            type: "POST",
            url: "/admin/member/listRecharge/<%=phone%>",
            data: {
            typeid: "1",
            pageno: pageno1,
            limit: limit1,
            language: "vi",
            },
            dataType: "json",
            success: function (response) {
            $('#text-recharge').text(--page1 + ' / ' + response.page_total);
            if (response.status === true) return RenderRecharge(response.datas);
            }
        });
        });
    </script>
    <!--Recharge-->

        <!--ROI-->
        <script>

function formateT(params) {
    let result = (params < 10) ? "0" + params : params;
    return result;
    }
    
    function timerJoin(params = '', addHours = 0) {
        let date = '';
        if (params) {
            date = new Date(Number(params));
        } else {
            date = new Date();
        }
    
        date.setHours(date.getHours() + addHours);
    
        let years = formateT(date.getFullYear());
        let months = formateT(date.getMonth() + 1);
        let days = formateT(date.getDate());
    
        let hours = date.getHours() % 12;
        hours = hours === 0 ? 12 : hours;
        let ampm = date.getHours() < 12 ? "AM" : "PM";
    
        let minutes = formateT(date.getMinutes());
        let seconds = formateT(date.getSeconds());
    
        return years + '-' + months + '-' + days + ' ' + hours + ':' + minutes + ':' + seconds + ' ' + ampm;
    }
            const RenderRoi = (datas) => {
                if (datas.length == 0) {
                    $('#list-roi').html(`
                        <tr class="text-center">
                        <td colspan="7">no data...</td>
                        </tr>
                    `);
                    return;
                }
                let html = '';
                datas.map((data) => {
                    html += 
                    `
                    <tr class="text-center" style="">
                        <td style="color: #e74c3c;font-weight: 600;min-width: 210px">${data.plan_id}</td>
                        <td><b style="color: #3498db">${(data.amount)}</b></td>
                        <td style="min-width: 210px;"><b>${data.user_id }</b></td>
                        <td class="project-state"><span class="badge badge-${(data.status == '1' ? 'success' : 'warning')}">${(data.status == '1' ? 'Active' : 'Expired')}</span></td>
                        <td style="min-width: 210px;"><b>${data.time}</b></td>
                    </tr>
                    `;
                });
                $("#list-roi").html(html);
            }
    
            var pageno1 = 0;
            var limit1 = 15;
            var page1 = 1;
            $.ajax({
            type: "POST",
            url: "/admin/member/roi/<%=phone%>",
            data: {
                typeid: "1",
                pageno: pageno1,
                limit: limit1,
                language: "vi",
            },
            dataType: "json",
            success: function (response) {
                $('#text-roi').text(page1 + ' / ' + response.page_total);
                if (response.status === true) return RenderRoi(response.datas);
            },
            });
    
            $('#nextRoi').click(function (e) {
            pageno1 += limit1;
            e.preventDefault();
            $.ajax({
                type: "POST",
                url: "/admin/member/roi/<%=phone%>",
                data: {
                typeid: "1",
                pageno: pageno1,
                limit: limit1,
                language: "vi",
                },
                dataType: "json",
                success: function (response) {
                    // console.log("this is plan Details :" + JSON.stringify(response))
                if(response.datas.length == 0) {
                    $('#nextRoi').addClass('block-click');
                    return pageno1 -= limit1
                };
                $('#text-roi').text(++page1 + ' / ' + response.page_total);
                if (response.status === true) return RenderRoi(response.datas);
                }
            });
            });
            
            $('#previousRoi').click(function (e) { 
            e.preventDefault();
            $('#nextRoi').removeClass('block-click');
            pageno1 -= limit1;
            if(pageno1 < 0) return pageno1 = 0;
            $.ajax({
                type: "POST",
                url: "/admin/member/roi/<%=phone%>",
                data: {
                typeid: "1",
                pageno: pageno1,
                limit: limit1,
                language: "vi",
                },
                dataType: "json",
                success: function (response) {
                $('#text-roi').text(--page1 + ' / ' + response.page_total);
                if (response.status === true) return RenderRoi(response.datas);
                }
            });
            });
        </script>
        <!--ROI-->
    <!--Redenvelope-->
    <script>
        const RenderRedenvelopes = (datas) => {
            if (datas.length == 0) {
                $('#list-redenvelope').html(`
                    <tr class="text-center">
                    <td colspan="7">no data...</td>
                    </tr>
                `);
                return;
            }
            let html = '';
            datas.map((data) => {
                html += 
                ` 
                <tr class="text-center" style="">
                    <td style="color: #e74c3c;font-weight: 600;min-width: 210px">${data.phone}</td>
                    <td><b style="color: #3498db">${(data.money)}</b></td>
                    <td style="min-width: 210px;"><b>${data.id_redenvelops}</b></td>
                    <td class="project-state"><span class="badge badge-success">success</span></td>
                    <td style="min-width: 210px;"><b>${timerJoin(data.time)}</b></td>
                </tr>
                `;
            });
            $("#list-redenvelope").html(html);
        }

        var pageno2 = 0;
        var limit2 = 15;
        var page2 = 1;
        $.ajax({
        type: "POST",
        url: "/admin/member/redenvelope/<%=phone%>",
        data: {
            typeid: "1",
            pageno: pageno2,
            limit: limit2,
            language: "vi",
        },
        dataType: "json",
        success: function (response) {
            $('#text-redenvelope').text(page2 + ' / ' + response.page_total);
            let total = 0;
            let amount = 0;
            for (let i = 0; i < response.datas.length; i++) {
                total += response.datas[i].money;
                amount += 1;
            }
            $('#totlaide').text(' â‚¹ ' + total   + " / " + amount + ' Lixi');
            if (response.status === true) return RenderRedenvelopes(response.datas);
        },
        });

        $('#nextRedenvelope').click(function (e) {
        pageno2 += limit2;
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/admin/member/redenvelope/<%=phone%>",
            data: {
            typeid: "1",
            pageno: pageno2,
            limit: limit2,
            language: "vi",
            },
            dataType: "json",
            success: function (response) {
            if(response.datas.length == 0) {
                $('#nextRedenvelope').addClass('block-click');
                return pageno2 -= limit2
            };
            $('#text-redenvelope').text(++page2 + ' / ' + response.page_total);
            if (response.status === true) return RenderRedenvelopes(response.datas);
            }
        });
        });
        
        $('#previousRedenvelope').click(function (e) { 
        e.preventDefault();
        $('#nextRedenvelope').removeClass('block-click');
        pageno2 -= limit2;
        if(pageno2 < 0) return pageno2 = 0;
        $.ajax({
            type: "POST",
            url: "/admin/member/redenvelope/<%=phone%>",
            data: {
            typeid: "1",
            pageno: pageno2,
            limit: limit2,
            language: "vi",
            },
            dataType: "json",
            success: function (response) {
            $('#text-redenvelope').text(--page2 + ' / ' + response.page_total);
            if (response.status === true) return RenderRedenvelopes(response.datas);
            }
        });
        });
    </script>
    <!--Redenvelope-->

    <!-- BET-->
    <script>
        const RenderBet = (datas) => {
            if (datas.length == 0) {
                $('#list-bet').html(`
                    <tr class="text-center">
                    <td colspan="7">no data...</td>
                    </tr>
                `);
                return;
            }
            let html = '';
            datas.map((data) => {
                html += 
                `
                <tr class="text-center" style="">
                    <td style="color: #e74c3c;font-weight: 600;min-width: 210px">${data.stage}</td>
                    <td><b style="color: #3498db">${(data.status == 1) ? "+" : "-"} ${(data.money)}</b></td>
                    <td style="min-width: 210px;"><b>${(data.game.toUpperCase())}</b></td>
                    <td class="project-state"><span class="badge badge-${(data.status == '1' ? 'success' : 'danger')}">${(data.status == '1' ? 'win' : 'loss')}</span></td>
                    <td style="min-width: 210px;"><b>${timerJoin(data.time)}</b></td>
                </tr>
                `;
            });
            $("#list-bet").html(html);
        }

        var pageno3 = 0;
        var limit3 = 30;
        var page3 = 1;
        $.ajax({
        type: "POST",
        url: "/admin/member/bet/<%=phone%>",
        data: {
            typeid: "1",
            pageno: pageno3,
            limit: limit3,
            language: "vi",
        },
        dataType: "json",
        success: function (response) {
            $('#text-bet').text(page3 + ' / ' + response.page_total);
            if (response.status === true) return RenderBet(response.datas);
        },
        });

        $('#nextBet').click(function (e) {
        pageno3 += limit3;
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/admin/member/bet/<%=phone%>",
            data: {
            typeid: "1",
            pageno: pageno3,
            limit: limit3,
            language: "vi",
            },
            dataType: "json",
            success: function (response) {
            if(response.datas.length == 0) {
                $('#nextBet').addClass('block-click');
                return pageno3 -= limit3
            };
            $('#text-bet').text(++page3 + ' / ' + response.page_total);
            if (response.status === true) return RenderBet(response.datas);
            }
        });
        });
        
        $('#previousBet').click(function (e) { 
        e.preventDefault();
        $('#nextBet').removeClass('block-click');
        pageno3 -= limit3;
        if(pageno3 < 0) return pageno3 = 0;
        $.ajax({
            type: "POST",
            url: "/admin/member/bet/<%=phone%>",
            data: {
            typeid: "1",
            pageno: pageno3,
            limit: limit3,
            language: "vi",
            },
            dataType: "json",
            success: function (response) {
            $('#text-bet').text(--page3 + ' / ' + response.page_total);
            if (response.status === true) return RenderBet(response.datas);
            }
        });
        });

        function setCookie(cname, cvalue, exdays) {
    const d = new Date();
    d.setTime(d.getTime() + exdays * 24 * 60 * 60 * 1000);
    let expires = "expires=" + d.toUTCString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

document.getElementById('login').addEventListener('click', function() {
    let username = $("#userPhone").val(); // Username input field value

    if (!username) {
        alert('Please enter a username/phone number.');
        return;
    }

    // API call to backend for login
    fetch('/api/admin/specific-login', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ username: username })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === true) {
            console.log(JSON.stringify(data))
            // Use the `data.token` and `data.value` from the response
            setCookie("token", data.token, 1);
            setCookie("auth", data.value, 1);
           
            setTimeout(() => {
                window.location.href = '/mian'; // Redirect to main/dashboard page
            }, 100); // 1 second delay before redirect for better UX
        } else {
            alert('Login failed: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while logging in. Please try again.');
    });
});

    </script>
    <!-- BET-->
    
        <script>
        $(document).ready(function () {
            $("#updateSubAdmin").click(function () {
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You are about to update the position!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, update it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: "/sub-admin/update-position",
                            type: "POST",
                            data: { phone: "<%=phone%>" },
                            success: function (response) {
                                Swal.fire(
                                    'Updated!',
                                    response.message || 'Position updated successfully!',
                                    'success'
                                )
                                console.log(response);
                                location.reload();
                            },
                            error: function (xhr, status, error) {
                                Swal.fire(
                                    'Error!',
                                    'Error updating position: ' + error,
                                    'error'
                                );
                                console.error(xhr.responseText);
                            }
                        });
                    }
                });
            });
            
              $("#updateWithdrawalSettingBox").click(function () {
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You are about to update the Withdrawal setting!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, update it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: "/admin/update-withdrawal-setting",
                            type: "POST",
                            data: { phone: "<%=phone%>" },
                            success: function (response) {
                                Swal.fire(
                                    'Updated!',
                                    response.message || 'Withdrawal setting updated successfully!',
                                    'success'
                                )
                                console.log(response);
                                location.reload();
                            },
                            error: function (xhr, status, error) {
                                Swal.fire(
                                    'Error!',
                                    'Error updating Withdrawal setting: ' + error,
                                    'error'
                                );
                                console.error(xhr.responseText);
                            }
                        });
                    }
                });
            });
        });
    </script>
    
        <script>
        $('#bankForm').on('submit', function (e) {
            e.preventDefault();
            const formData = {};
            // let hasEmpty = false;

            // Validate required fields
            $(this).find('input').each(function () {
                const name = $(this).attr('name');
                const value = $(this).val().trim();
                formData[name] = value;
            });

            // if (hasEmpty) return;

            // Confirm update
            const confirmUpdate = confirm("Are you sure you want to update the bank information?");
            if (!confirmUpdate) return;


            console.log(JSON.stringify(formData), "JSON.stringify(formData)")

            // API call via AJAX
            $.ajax({
                url: `/admin/update-bank-details/<%=phone%>`,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function (response) {
                    alert('Bank information updated successfully!');
                    console.log(response);
                },
                error: function (xhr, status, error) {
                    alert('Failed to update bank information!');
                    console.error(error);
                }
            });
        });
    </script>
</body>

</html>