<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Salary History</title>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="//cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">
  <link rel="stylesheet" href="/dist/css/adminlte.min.css">
  <link rel="stylesheet" href="/css/admin.css">
</head>

<body class="hold-transition sidebar-mini">
  <div class="wrapper">
    <%- include('nav') %>
      <div class="content-wrapper">
        <section class="content-header">
          <div class="container-fluid">
            <div class="row mb-2">
              <div class="col-sm-6">
                <h1>Salary History</h1>
              </div>
            </div>
          </div>
          <!-- /.container-fluid -->
        </section>

        <!-- Main content -->
        <section class="content">

          <!-- Default box -->
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Salary Records History Table</h5>
              <table class="table" id="tableget">
                <thead>
                  <tr>
                    <th class="text-center">Sr.</th> 
                    <th class="text-center">Amount</th>
                    <th class="text-center">Type</th>
                    <th class="text-center">Time</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Add your table rows dynamically here -->
                </tbody>
              </table>
            </div>
          </div>

        </section>
      </div>
  </div>
  <script src="/plugins/jquery/jquery.min.js"></script>
  <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/dist/js/adminlte.min.js"></script>
  <script src="/js/admin/admin.js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
  <script>
  
  function show(params) {
    if (params.length == 0) {
        $('tbody').html(`
            <tr class="text-center">
              <td colspan="7">No More...</td>
            </tr>
        `);
        return;
    }
    
    let html = '';
  let show = params.map((data, index) => {  // Add 'index' parameter in the map function
    html += `<tr class="text-center">
              <td id="${data.id}">
                ${index + 1}  <!-- Serial number -->
              </td>
              <td>
                <b>${(data.amount)}</b>
              </td>
              <td>
                ${(data.type == 'daily') ? '<b style="color: #3498db">Daily</b>' : '<b style="color: #a50064">Monthly</b>'}
              </td>
              <td>
                <b>${(data.time)}</b>
              </td>
            </tr>`;
});

    $('tbody').html(html);

    // Event Listener for Accept Button
    $('.btn-success').click(function (e) {
        e.preventDefault();
        let id = $(this).attr('data');
        $.ajax({
            type: "POST",
            url: "/api/webapi/admin/salary-status",
            data: {
                id: id,
                type: 'confirm'
            },
            dataType: "json",
            success: function (response) {
                Swal.fire(
                    'Good job!',
                    'You Accepted The Recharge!',
                    'success'
                )
                setTimeout(() => {
                    location.reload();
                }, 1000); // Reload after 1 second
            }
        });
    });

    // Event Listener for Reject Button
    $('.btn-danger').click(function (e) {
        e.preventDefault();
        let id = $(this).attr('data');
        $.ajax({
            type: "POST",
            url: "/api/webapi/admin/salary-status",
            data: {
                id: id,
                type: 'delete'
            },
            dataType: "json",
            success: function (response) {
                Swal.fire(
                    'Good job!',
                    'You Rejected The Recharge!',
                    'success'
                )
                setTimeout(() => {
                    location.reload();
                }, 1000); // Reload after 1 second
            }
        });
    });
}

   

  $.ajax({
    type: "GET",
    url: "/api/webapi/admin/getSalaryRecordHistory",
    dataType: "json",
    success: function (response) {
        console.log(response);
        // Safely pass data to the show function
        show(response.data?.getPhone || []);
    },
    error: function (xhr, status, error) {
        console.log('Error fetching data:', error);
        // Optionally show an error alert
        Swal.fire('Error', 'Failed to fetch data. Please try again.', 'error');
    }
});



  </script>

</body>

</html>